{"version":3,"file":"OsbMangaReader.js","sourceRoot":"","sources":["../src/OsbMangaReader.ts"],"names":[],"mappings":"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","sourcesContent":["import {Component} from '@angular/core';\nimport { Http, HTTP_PROVIDERS, Headers, RequestOptions } from '@angular/http';\nimport 'Swiper';\ndeclare let Swiper;\n\n@Component({\n    selector: 'osb-manga-reader',\n    templateUrl: 'vendor/osb-manga-reader/lib/OsbMangaReader.html',\n    styleUrls: ['vendor/osb-manga-reader/lib/OsbMangaReader.css']\n})\nexport class OsbMangaReader {\n    isLoading = true;\n    section = '';\n    baseUrl = '';\n    defaultSite = '';\n    apiKey = '';\n    listStyle = false;\n\n    mangaDetails = [];\n    mangaInfo = {};\n    mangaChapter = {};\n\n    siteFavouritesUrl = '';\n    siteFavouritesData = [];\n    siteFavouritesDisplay = [];\n\n    mainListViewData = [];\n    mainListViewDisplay = [];\n    mainListViewDisplayCount = 0;\n\n    sliderSettings = {};\n\n    constructor(public http: Http) {\n        this.isLoading = true;\n        this.listStyle = false;\n        this.section = 'site-favourites';\n\n        this.baseUrl = 'https://doodle-manga-scraper.p.mashape.com/';\n        this.apiKey = 'xiQSdA9ACbmshUxnm4ZBC8nn2umSp1LeqQfjsnnVeMWHHSIQy0';\n        this.defaultSite = 'mangareader.net';\n\n        this.siteFavouritesUrl = 'http://private-e00abd-osbmangareader.apiary-mock.com/topfeed';\n        this.siteFavouritesData = [];\n        this.siteFavouritesDisplay = [];\n\n        this.mangaDetails = [];\n        this.mangaInfo = {};\n        this.mangaChapter = {};\n\n        this.mainListViewData = [];\n        this.mainListViewDisplay = [];\n        this.mainListViewDisplayCount = 0;\n\n        this.sliderSettings = {\n            'slidesPerView': 1,\n            'keyboardControl': true,\n            'preloadImages': false,\n            'lazyLoading': true\n        };\n        console.log(this);\n        this.checkCache();\n    }\n\n    checkCache() {\n        var mainListData = localStorage.getItem('osbMangaReader.mainList');\n        if (mainListData) {\n            this.mainListViewData = JSON.parse(mainListData);\n        }\n\n        var siteFavourites = localStorage.getItem('osbMangaReader.siteFavourites');\n        if (siteFavourites) {\n            this.siteFavouritesData = JSON.parse(siteFavourites);\n        }\n\n        var mangaDetails = localStorage.getItem('osbMangaReader.mangaDetails');\n        if (mangaDetails) {\n            this.mangaDetails = JSON.parse(mangaDetails);\n        }\n        this.getSiteFavourites();\n    }\n\n    initSlider() {\n        var holder = this;\n        setTimeout(function(){\n            var viewportSize = window.innerHeight - 90;\n            document.querySelector('.osb-manga-reader-holder .swiper-container').setAttribute('style','height:' + viewportSize + 'px;');\n            var mangaView = new Swiper(document.querySelector('.osb-manga-reader-holder .swiper-container'), holder.sliderSettings);\n        }, 500);\n    }\n\n    getMangaChapter(manga, chapter) {\n        let headers = new Headers({ 'X-Mashape-Authorization': this.apiKey });\n        let options = new RequestOptions({ headers: headers });\n        this.http.get(this.baseUrl + this.defaultSite  + '/manga/' + manga + '/' + chapter, options)\n            .subscribe(response => this.setMangaChapter(response));\n    }\n\n    setMangaChapter(chapter) {\n        this.mangaChapter = chapter.json();\n        this.section = 'manga-chapter';\n        this.isLoading = false;\n        this.initSlider();\n    }\n\n    getMainMangaList() {\n        var holder = this;\n        if (this.mainListViewData.length > 1) {\n            var mainViewData = this.mainListViewData.slice(0, 20);\n            mainViewData.forEach(function(element) {\n                holder.getMangaDetails(element, 'main-view', false);\n            });\n            return false;\n        }\n        let headers = new Headers({ 'X-Mashape-Authorization': this.apiKey });\n        let options = new RequestOptions({ headers: headers });\n        this.http.get(this.baseUrl + this.defaultSite, options)\n            .subscribe(response => this.setMainMangaList(response));\n    }\n\n    viewMangaDetails (manga) {\n        this.mangaInfo = manga;\n        this.section = 'manga-info';\n    }\n\n    setMainMangaList(data) {\n        console.log(data.json());\n        var holder = this;\n        this.mainListViewData = data.json();\n        localStorage.setItem('osbMangaReader.mainList', JSON.stringify(this.mainListViewData));\n\n        var mainViewData = this.mainListViewData.slice(0, 20);\n        mainViewData.forEach(function(element) {\n            holder.getMangaDetails(element, 'main-view', false);\n        });\n    }\n\n    getMangaDetails(manga, section, cache) {\n        var holder = this;\n        if (this.mangaDetails.length > 1 && cache) {\n            this.mangaDetails.forEach(function(element) {\n                if (manga.title === element.name) {\n                    if (section === 'site-favourites' && holder.siteFavouritesDisplay.indexOf(element) == -1) {\n                        holder.section = 'site-favourites';\n                        holder.siteFavouritesDisplay.push(element);\n                        holder.isLoading = false;\n                    }\n                }\n            });\n            return false;\n        }\n\n        let headers = new Headers({ 'X-Mashape-Authorization': this.apiKey });\n        let options = new RequestOptions({ headers: headers });\n        this.http.get(this.baseUrl + this.defaultSite + '/manga/' + manga.mangaId, options)\n            .subscribe(response => this.setMangaDetails(response, section, cache));\n    }\n\n    setMangaDetails(manga, section, cache) {\n        var data = manga.json();\n        if (cache) {\n            this.mangaDetails.push(data);\n            localStorage.setItem('osbMangaReader.mangaDetails', JSON.stringify(this.mangaDetails));\n        }\n\n        if (section === 'main-view') {\n            this.section = 'main-view';\n            this.mainListViewDisplay.push(data);\n            this.isLoading = false;\n        }\n\n        if (section === 'site-favourites') {\n            this.section = 'site-favourites';\n            this.siteFavouritesDisplay.push(data);\n            this.isLoading = false;\n        }\n    }\n\n    getSiteFavourites() {\n        var holder = this;\n        this.siteFavouritesDisplay = [];\n        if (this.siteFavouritesData.length > 1) {\n            this.siteFavouritesData.forEach(function(element) {\n                holder.getMangaDetails(element, 'site-favourites', true);\n            });\n\n            return false;\n        }\n        this.http.get(this.siteFavouritesUrl)\n            .subscribe(response => this.setSiteFavourites(response));\n    };\n\n    setSiteFavourites(data) {\n        var holder = this;\n        this.siteFavouritesData = data.json();\n        localStorage.setItem('osbMangaReader.siteFavourites', JSON.stringify(this.siteFavouritesData));\n        this.siteFavouritesData.forEach(function(element) {\n            holder.getMangaDetails(element, 'site-favourites', true);\n        });\n    }\n\n}"]}